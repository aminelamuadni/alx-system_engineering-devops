#!/usr/bin/env bash

PID_FILE="/var/run/my_process.pid"
COMMAND_PATH="./manage_my_process"

function is_process_running() {
    [ -f "$PID_FILE" ] && kill -0 "$(cat "$PID_FILE")" 2>/dev/null
}

case "$1" in
    start)
        if is_process_running; then
            echo "manage_my_process is already running."
            exit 1
        else
            $COMMAND_PATH & echo $! > "$PID_FILE"
            echo "manage_my_process started."
        fi
        ;;
    stop)
        if is_process_running; then
            kill "$(cat "$PID_FILE")" && rm "$PID_FILE"
            echo "manage_my_process stopped."
        else
            echo "manage_my_process is not running."
            exit 1
        fi
        ;;
    restart)
        if is_process_running; then
            kill "$(cat "$PID_FILE")"
            rm "$PID_FILE"
        fi
        $COMMAND_PATH & echo $! > "$PID_FILE"
        echo "manage_my_process restarted."
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac
